from kafka import KafkaProducer
import time,csv

'''
input csv example

AT,BE,BG,CH,CY,CZ,DE,DK,EE,ES,FI,FR,EL,HR,HU,IE,IT,LT,LU,LV,NL,NO,PL,PT,RO,SI,SK,SE,UK
0.117482517482517,0.0,0.13514119928954302,0.0689499865149865,0,0.0692151894582339,0.0192612252265842,0.0,0.030179321572225002,0.0439209623544281,0.0,0.0420031786189225,0.0946669074417797,0.0629568369905699,0.0705369411416471,0.0,0.0753781805489794,0.07888051052619201,0.0,0.043221759900893,0.0,0.0,0.0652167228518484,0.0,0.0989798884775355,0.0487534737408071,0.18038589191510201,0.0,0.0
0.16643356643356602,0.0649059373640713,0.206412245903637,0.152344130277375,0,0.12723754233188198,0.0699989098520837,0.0445906122227055,0.074671057216723,0.14601200686106303,0.0312562393254266,0.123842705213728,0.140324840676974,0.0933440236461398,0.0784650330822483,0.0,0.12608696525094398,0.175600713722861,0.0307416137451066,0.0892029596045131,0.0582313746180572,0.0204737943258439,0.108219876542885,0.125138019874862,0.111118250741029,0.0520761582340695,0.23842103849347,0.0393352712944668,0.0474854446145074
0.148251748251748,0.0526037067060338,0.21192484912962,0.222754259208225,0,0.135462022254475,0.10635079036769099,0.0778091278816877,0.068019201583588,0.20926243567752997,0.0294038862647706,0.158755711424721,0.177844451122947,0.0916852371192743,0.0726694259677755,0.0240746803330746,0.139671193561948,0.143990574177311,0.0998991655234717,0.104234873469044,0.0720722458429247,0.048923973779995994,0.102523838049968,0.196234719967364,0.097953449761225,0.0387057462090461,0.21462378095691503,0.0826699344612236,0.10951678628072099
0.165034965034965,0.0553909308394954,0.19536856025435298,0.28145188261014303,0,0.20754716981132101,0.159913056916655,0.089586253153545,0.0800573302284008,0.24708337149661103,0.0310585021934467,0.198553152005591,0.184307253426474,0.13537542058627,0.0822931029476574,0.0266788896337591,0.179988912037398,0.198154748638978,0.0638172606447248,0.0941857713972612,0.0608086297104398,0.0532253523460051,0.124982243644703,0.24046129309287198,0.0980706520084161,0.0445696165368087,0.21547424342808605,0.0941345276462946,0.164216422322982
0.153846153846154,0.0574298608090474,0.17998020667844197,0.283257055710493,0,0.201180129916386,0.15786182551421,0.0894978895171814,0.0592654857337755,0.28553508719719106,0.0272725421131688,0.201228475964132,0.19125645711453,0.12973931020996798,0.0693788422924593,0.0353903213302822,0.176609673638496,0.18031691992253304,0.038512485138466,0.0699402484991519,0.0514788695043784,0.0521917879609568,0.12441342269207402,0.272359219727641,0.0883007312319391,0.0420858995986127,0.17686247662628798,0.102217927249598,0.155820023810148
0.132867132867133,0.0737413005654632,0.143731212620855,0.23957153996410102,0,0.138848572810837,0.129450147471028,0.0723945457652395,0.0273835030629286,0.297286516966083,0.0202088342389387,0.183848274982349,0.168335172274792,0.0936919426129035,0.0624124968922599,0.0447559245930003,0.172963745366059,0.0841665629336909,0.0308979417137886,0.0553170714264112,0.0326712349479335,0.0515802068141833,0.10779399259804501,0.269905533063428,0.0821430361305361,0.0430999104913038,0.129228446414091,0.0712786098030329,0.122489550502618
0.111888111888112,0.0924314919530231,0.04954470711897099,0.20047605726568302,0,0.0948234155781326,0.0837197454239951,0.0428918921270117,0.0,0.267982694495865,0.0,0.14734448372669598,0.13571715934131198,0.054294528675727004,0.0496803222703223,0.0500361330887023,0.13792834473111099,0.0,0.0266406524575903,0.0,0.0244799474303331,0.0220206491033653,0.06981963411217,0.228192859771807,0.0626512843175343,0.0432110751434445,0.116316225591646,0.0294765522823,0.0702785030461271
0.15104895104895097,0.155978142670726,0.0,0.132959173102667,0,0.0261248185776488,0.0314454263905056,0.0,0.0,0.22130378970001602,0.0,0.0881265984931488,0.09026049932169501,0.056874262941565,0.0841602727424313,0.0494006197388216,0.0912473405767843,0.0,0.0656217442366246,0.0,0.0432966804004962,0.0,0.0,0.19138755980861197,0.0,0.0521335743946527,0.0,0.0,0.0434660616908725

'''

# create producer to kafka connection
producer = KafkaProducer(bootstrap_servers='89.218.20.173:9092')
# define *.csv file and a char that divide value
fname = "input.csv"
divider_char = ','
# open file
with open(fname) as fp:  
	# read header (first line of the input file)
	line = fp.readline()
	header = line.split(divider_char)
	
	#loop other data rows 
	line = fp.readline()	
	while line:
		# start to prepare data row to send
		'''
		example of outputs is valid JSON row 
		{
			"AT":"0.148251748251748",
			"BE":"0.052603706790461",
				...
			"SE":"0.0826699344612236",
			"UK":"0.10951678628072099"
		}
		'''
		data_to_send = ""
		values = line.split(divider_char)
		len_header = len(header)
		for i in range(len_header):
			data_to_send += "\""+header[i].strip()+"\""+":"+"\""+values[i].strip()+"\""
			if i<len_header-1 :
				data_to_send += ","
		data_to_send = "{"+data_to_send+"}"
		# send data via producer
		producer.send('test', bytes(data_to_send, encoding='utf-8'))
		line = fp.readline()
		# А это так))) на всякий случай
		#time.sleep(1)
producer.close()

